<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ncst.hospitaloutpatient.mapper.organization.AdminMapper">

    <!-- 判断staff_id是否为医生 -->
    <select id="isDoctorRole" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM staff s
                 JOIN staff_role r ON s.role_id = r.role_id
        WHERE s.staff_id = #{staffId}
          AND r.role_name = 'doctor'
    </select>

    <update id="updateDoctorQuota">
        UPDATE doctor_quota
        SET quota = #{quota}
        WHERE staff_id = #{doctorId}
          AND quota_date = #{quotaDate}
    </update>

    <insert id="insertDoctorQuota">
        INSERT INTO doctor_quota (staff_id, quota_date, quota, used)
        VALUES (#{doctorId}, #{quotaDate}, #{quota}, 0)
    </insert>

    <update id="updateRegistrationFee">
        UPDATE number_type_config
        SET fee = #{fee}
        WHERE number_type = #{numberType}
    </update>

</mapper>